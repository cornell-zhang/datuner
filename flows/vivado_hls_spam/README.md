# Tutorial


### C-simulation

The Logistic Regression benchmark has been written in C. The current version also supports C simulation so that functionality of the algorithm can be tested without going through the painful process of bitstream generation.

To do the C-simulation of the design, uncomment #define HW and #define CSIM in the file LogisticRegression_accel.h and enter the following command in the main directory:

```javascript
% make csim
```

This will create a hls.prj directory containing all the logs for the C simulation. 

One should always do C-simulation before synthesizing the design as it is fast and detects the trivial syntactic/algorithmic errors.

### Bitstream generation

To synthesize the design for FPGA type, uncomment #define HW in the file LogisticRegression_accel.h and enter the following command in the main directory:

```javascript
% make
```

This will produce two folders:

```javascript
./_sds
./sd_card
```

The _sds folder will have all the reports generated by SDSoC and Vivado-HLS. The sd_card folder will have the bitstream and the associated files which will be used to port face-detection accelerator onto the FPGA.

The timing and utilization reports generated by Vivado-HLS can be found in the following directory:

```javascript
_sds/vhls/logisticreg_accel/solution/syn/report
```

The log generated by Vivado-HLS can be found as:

```javascript
_sds/vhls/vivado_hls.log
```
The area, utilzation and timing reports generated by SDSoC can be found in the following directory:

```javascript
_sds/reports
```

### Porting Logistic Regression accelerator onto the FPGA

To port the Logistic Regression accelerator onto the FPGA copy all the files in the sd_card folder into the SD-card of the FPGA. After that you can reboot the FPGA board and connect it to your computer using UART. Go to the mnt folder and run logistic_reg.elf binary

```javascript
$ cd /mnt
$ ./logistic_reg.elf
```

This will print the accuracy of the testing process. In addition, it will give the time taken to train the model. Wait for a while ( 4-5 seconds ) and remove the SD-card and insert it in your computer. 

### Copying data to the FPGA board

The training and testing data should be copied to the board within /mnt/data folder. The data folder should be kept in the same directory as the LogisticRegression.cpp and LogisticRegression_accel.cpp files.

### ARM only

The current code cannot be run on ARM processor due to the optimzation using hardware function. To get parameters on ARM processor, please refer to the prior version code.

# Optimizations in the application

1.	Sigmoid function (also called logistic function) is an expensive operation on FPGA. To improve the timing of sigmoid function, a LUT based sigmoid function is used which essentially stores the value of sigmoid function for the values relevant to this application.

2.	Parameter vector is only updated in the last iteration of the last training sample of the last EPOCH. This is done to eliminate the unnecessary data transfer which is already a bottleneck. Further, parameter vector accesses the parameter vector through shared memory, achieved through zero_copy.

3.	The data vector which stored the features of the training samples is non-cacheable since cache flushing/invalidating for a large chunk of data(1024 features) in ech iteration can significantly decrease the system performance. 

4. Data mover: To transfer data from processor memory to device programmable logic (PL) and back, AFI interface is used since it provides  fast non-cache coherent access to DDR via the PS memory controller.


